Emmanuel Caisse

Assignment #2

1. Find hour of the day that most number of tweets was generated by users on March 6, 2010
A- create and load tweet data as external table
drop table twitter.full_text;
create external table twitter.full_text (                                                   
          id string, 
          ts string, 
          lat_lon string,
          lat string, 
          lon string, 
          tweet string)
row format delimited 
fields terminated by '\t'
location '/user/twitter/full_text' ; 

B- Convert timestamp
create table twitter.full_text_ts as
select id, cast(concat(substr(ts,1,10), ' ', substr(ts,12,8)) as timestamp) as ts, lat, lon, tweet
from twitter.full_text;

C- count tweets for each hour of 3MAR10
select hour(ts) as hour, count(*) as cnt
from twitter.full_text_ts
where to_date(ts) = '2010-03-06'
group by hour(ts) 
order by cnt desc
limit 15;

Answer: Most tweets of this data set occur at 1AM GMT (see Word doc for screen cap)

2 - Find top 10 topics (hashtags)

A - create external table twitter.full_text_ts_tmp (id string, ts timestamp, tweet string, hash string)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY '\t'
COLLECTION ITEMS TERMINATED BY ','
MAP KEYS TERMINATED BY ':'
location '/user/twitter/full_text_ts_complex';

B- capture hashtags

insert overwrite table twitter.full_text_ts_tmp
select id, ts, tweet, concat(regexp_extract(lower(tweet), '(#(\w+))\b', length(tweet))) as hash
from twitter.full_text_ts;

C- reload table

create external table twitter.full_text_ts_complex (
                       id                 string,
                       ts                 timestamp,
                       tweet              string,
                       hash_struct       struct<mention:string, size:int>
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY '\t'
COLLECTION ITEMS TERMINATED BY ','
MAP KEYS TERMINATED BY ':'
location '/user/twitter/full_text_ts_complex';


3- find top 10 mentions


